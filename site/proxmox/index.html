
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://wiki.aosc-portal.com/proxmox/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.3">
    
    
      
        <title>Proxmox documentation - Sandbox Support</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#proxmox" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Sandbox Support" class="md-header__button md-logo" aria-label="Sandbox Support" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sandbox Support
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Proxmox documentation
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Sandbox Support" class="md-nav__button md-logo" aria-label="Sandbox Support" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    Sandbox Support
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Proxmox
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Proxmox" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Proxmox
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="#installation" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="#gestion-des-acces" class="md-nav__link">
        Gestion des accès
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="#problemes-connus" class="md-nav__link">
        Problèmes connus
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="#gestion-de-la-virtualisation" class="md-nav__link">
        Gestion de la virtualisation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          PfSense
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="PfSense" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          PfSense
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pfsense/#ovh" class="md-nav__link">
        OVH
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pfsense/#gestion-du-reseau" class="md-nav__link">
        Gestion du réseau
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pfsense/#les-acces" class="md-nav__link">
        Gestion des accès
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pfsense/#wireguard" class="md-nav__link">
        Wireguard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pfsense/#openvpn" class="md-nav__link">
        OpenVPN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pfsense/#rest-api" class="md-nav__link">
        REST API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#le-stockage" class="md-nav__link">
    Le stockage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-reseaux" class="md-nav__link">
    Les réseaux
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gestion-des-acces" class="md-nav__link">
    Gestion des accès
  </a>
  
    <nav class="md-nav" aria-label="Gestion des accès">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#les-utilisateurs" class="md-nav__link">
    Les utilisateurs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-groups" class="md-nav__link">
    Les groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-pools" class="md-nav__link">
    Les pools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentification-double-facteur" class="md-nav__link">
    Authentification double facteur
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problemes-connus" class="md-nav__link">
    Problèmes connus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gestion-de-la-virtualisation" class="md-nav__link">
    Gestion de la virtualisation
  </a>
  
    <nav class="md-nav" aria-label="Gestion de la virtualisation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gestion-des-images-iso" class="md-nav__link">
    Gestion des images ISO
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="proxmox">Proxmox</h1>
<h2 id="installation">Installation</h2>
<p>L'installation se fait par le biais de la console web OVH. Le processus est automatisé et guidé.</p>
<h3 id="le-stockage">Le stockage</h3>
<p>Le stockage du serveur Proxmox est géré par le système de fichier <strong>ZFS</strong>.
C'est celui ci qui gère le RAID des disques physiques en un seul et même <strong>Pool ZFS</strong>.</p>
<div class="highlight"><pre><span></span><code>zpool status
</code></pre></div>
<div class="admonition done">
<p class="admonition-title">Done</p>
<div class="highlight"><pre><span></span><code>  pool: zp0
state: ONLINE
status: Some supported and requested features are not enabled on the pool.
    The pool can still be used, but some features are unavailable.
action: Enable all features using &#39;zpool upgrade&#39;. Once this is done,
    the pool may no longer be accessible by software that does not support
    the features. See zpool-features(7) for details.
scan: scrub repaired 0B in 00:06:53 with 0 errors on Sun Sep 11 00:30:55 2022
config:

    NAME        STATE     READ WRITE CKSUM
    zp0         ONLINE       0     0     0
    sda2      ONLINE       0     0     0

errors: No known data errors
</code></pre></div>
</div>
<p>Le <strong>Pool ZFS</strong> est découpé en plusieurs systèmes de fichiers <strong>ZFS</strong> :</p>
<ol>
<li><code>zp0/zd0</code>: La partition de boot</li>
<li><code>zp0/zd1</code>: La partition système</li>
<li><code>zp0/zd2</code>:Le stockage de l'hyperviseur</li>
</ol>
<div class="highlight"><pre><span></span><code>zfs list
</code></pre></div>
<div class="admonition done">
<p class="admonition-title">Done</p>
<div class="highlight"><pre><span></span><code>NAME      USED  AVAIL     REFER  MOUNTPOINT
zp0      65.6G  7.08T       96K  none
zp0/zd0   173M   851M      173M  legacy
zp0/zd1  3.92G  44.9G     3.92G  legacy
zp0/zd2  61.4G  7.08T     61.4G  legacy
</code></pre></div>
</div>
<h3 id="les-reseaux">Les réseaux</h3>
<p>Si besoin, des réseaux privés peuvent être créés.</p>
<p>Pour cela, on se déplace dans l'onglet de gestion du réseau de Proxmox :</p>
<p><a href="../assets/navigation_proxmox_network_creation.png"><img alt="navigation proxmox network creation" src="../assets/navigation_proxmox_network_creation.png" /></a></p>
<p>Puis un créé une nouvelle interface réseau virtuelle (<em>Linux Bridge</em>) :</p>
<p><a href="../assets/proxmox_network_creation.png"><img alt="proxmox network creation" src="../assets/proxmox_network_creation.png" /></a></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Dans la section commentaire, on renseignera le pool auquel cette interface est liée ainsi que le réseau présent sur cette interface pour aider les utilisateurs lors de l'affectation d'un réseau à une machine virtuelle.</p>
</div>
<p>Pour finir, on ajoute la nouvelle interface au PfSense :</p>
<p><a href="../assets/pfsense_network_interface_attribution.png"><img alt="pfsense network interface attribution" src="../assets/pfsense_network_interface_attribution.png" /></a></p>
<p>Lors de la création ou de la re configuration d'une machine virtuelle, il suffira de choisir le réseau souhaité :</p>
<p><a href="../assets/proxmox_vm_network_affectation.png"><img alt="proxmox vm network affectation" src="../assets/proxmox_vm_network_affectation.png" /></a></p>
<p>Pour les détails concernants la configuration côté <strong>PfSense</strong>, se référer à la <a href="/pfsense/#interfaces-reseaux">documentation</a> liée.</p>
<h2 id="gestion-des-acces">Gestion des accès</h2>
<h3 id="les-utilisateurs">Les utilisateurs</h3>
<p>Pour créer un utilisateur on se rend dans la rubrique des gestion des utilisateurs :</p>
<p><a href="../assets/navigation_proxmox_user_creation.png"><img alt="navigation proxmox user creation" src="../assets/navigation_proxmox_user_creation.png" /></a></p>
<p>Puis on créé un nouvel utilisateur :</p>
<p><a href="../assets/proxmox_user_creation.png"><img alt="navigation proxmox user creation" src="../assets/proxmox_user_creation.png" /></a></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Il existe deux mode d'authentification dans proxmox :  </p>
<p>La première est la <strong>PAM</strong> qui est héritée de l'authentification <strong>Linux</strong>.<br />
La seconde est la <strong>PVE</strong> qui est l'authentification relative à <strong>Proxmox</strong>.  </p>
<p>Dans le premier cas, l'authentification se trouve au niveau du serveur, et un accès au shell notamment <strong>SSH</strong> est possible.<br />
Dans le second cas, l'authentification n'est valide qu'au niveau applicatif (WebUI Proxmox).</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Les comptes <strong>PAM</strong> seront délivrés aux collaborateurs succeptibles de participer à la maintenance de l'hyperviseur ou à intervenir dessus en cas de problèmes.</p>
</div>
<h3 id="les-groups">Les groups</h3>
<p>Il existe plusieurs groupes correspondant au différents projets :</p>
<ul>
<li>Admin</li>
<li>Operator</li>
<li>Default</li>
<li>Support</li>
<li>Casio</li>
</ul>
<p>Ces groupes correspondent aux différentes activités sur l'hyperviseur.</p>
<h3 id="les-pools">Les pools</h3>
<p>Les pools regroupent les machines virtuelles par projets ou par utilisation.
Chaque Pool dispose d'une restriction d'accès ne permettant qu'aux utilisateur faisant parti du groupe correspondant d'avoir accès aux ressources présentes dans le Pool.</p>
<p><a href="../assets/proxmox_pool_restrictions.png"><img alt="proxmox pool restrictions" src="../assets/proxmox_pool_restrictions.png" /></a></p>
<h3 id="authentification-double-facteur">Authentification double facteur</h3>
<p>Pour activer l'authentification multi facteur, il suffit de dérouler le menu utilisateur en haut à droite de l'interface web puis de sélectionner le TFA.<br />
Cela aura pour effet de rediriger sur l'interface de gestion des TFA.</p>
<p>Il suffit ensuite de sélectionner son utilisateur puis de cliquer sur ajouter pour configurer l'accès. Copiez le secret dans votre application de gestion de jetons puis renseignez le code généré par l'application ainsi que le mot de passe du compte pour valider la configuration du TFA.</p>
<p><a href="../assets/proxmox_totp_creation.png"><img alt="proxmox totp creation" src="../assets/proxmox_totp_creation.png" /></a></p>
<h2 id="problemes-connus">Problèmes connus</h2>
<p>Une des mise à jour du noyau du système a réussi à casser le programme de démarrage (<strong>GRUB</strong>).<br />
Le serveur a donc redémarré en mode urgence.</p>
<p>Dans le shell <strong>BusyBox</strong>, il a suffit d'importer à nouveau le pool ZFS qui était vu comme appartenant à un autre système.<br />
En <strong>IPMI</strong>, exécuter la commande suivante :</p>
<div class="highlight"><pre><span></span><code>zpool import -f zp0
</code></pre></div>
<p>Pour finir, toujours en <strong>IPMI</strong>, éteindre le serveur, puis le redémarrer et attendre qu'il démarre correctement.</p>
<h2 id="gestion-de-la-virtualisation">Gestion de la virtualisation</h2>
<h3 id="gestion-des-images-iso">Gestion des images ISO</h3>
<p>Illustration de l'ajout d'une image ISO au dépôt :</p>
<ul>
<li>Télécharger une ISO depuis une url avec le bouton Download. (droits administrateurs requis)</li>
<li>Télécharger une ISO depuis sa machine avec le bouton Upload.</li>
<li>Supprimer une ISO en la sélectionnant puis cliquer sur Supprimer.</li>
</ul>
<p><a href="../assets/proxmox_download_images_ISO.png"><img alt="proxmox download image iso" src="../assets/proxmox_download_images_ISO.png" /></a></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand"], "search": "../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.37e9125f.min.js"></script>
      
    
  </body>
</html>